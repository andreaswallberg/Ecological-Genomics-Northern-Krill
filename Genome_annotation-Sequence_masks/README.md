# Scripts for generating genome masks and associated files
## depth2accessibility_profile.pl

This script generates a binary accessibility mask / profile based on per-base sequence or genotyping depth information, such as that printed by samtools. The depth data needs to be provided on one line per sequence:

    #SAMPLE bar_10 bar_1 bar_2 bar_3 bar_4 bar_5 bar_6 bar_7 bar_8 bar_9 brc_1 brc_2 brc_3 brc_4 brc_5 brc_6 brc_7 can_10 can_1 can_2 can_3 can_4 can_5 can_6 can_7
    seq_s_12    142 145 146 148 150 150 152 153 153 154
    seq_s_15    63  70  70  76  77  77  82  82  94  95

The depth file can have a header on the first line ("#...") as above. Each consecutive line contains the name of the sequence and the depth at every position along the sequence (in the above example, the first 10 positions are shown for both sequences).

The depth file can optionally be gzipped.

The output mask is generated by specifying lower and upper thresholds for considering a position accessible. The resulting per-base accessibility mask will have the following character states:

    0 => inaccessible
    1 => accessible

### Usage example:

    depth2depth_profile.pl <LOWER> <UPPER> <genome_mask_accessible> genome_depth.csv.gz

### Helper scripts

The **merge_depths.pl** can merge two or more depth files:

    merge_depths.pl genome_merged genome_depth_1.csv.gz genome_depth_2.csv.gz

Here the first argument is the basename of the output file.

This script does no re-compute the depth. Instead it just merges the information. If two input files had depth information for the same sequence, there will be two consecutive lines for this sequence in the output.

The **compute_depths.pl** can sum (re-compute) the depths for sequences that are represented by multiple lines (i.e. after merging):

    compute_depths.pl genome_recomputed genome_merged.csv.gz

Here the first argument is the basename of the output file.

## compute_sample_coverage_from_depths.pl

This script reads a depth file (as above), and outputs the number of genotyped samples at every position (i.e. samples with depths > 0).

### Usage example:

    compute_sample_coverage_from_depths.pl <genome_genotyped> genome_depth.csv.gz

Here the first argument is the basename of the output file.

## gtf2gene_regions.comprehensive.pl

This script generates two per-base gene region masks for the genome using a table of sequence lengths and a GTF/GFF3 file with gene and CDS coordinates.

The length information can either be provided using a tabular "lengths" file (using "-length"), which assumes a header line is present on the first line and that sequence name and length are provided in the second and third columns, respectively. Alternatively, a BED file can be provided (using "-bed" instead), which is assumed to have sequence name and length in the first and second columns and to have no header line. More than one such file can be provided and both types can be used at the same time.

It prints one mask with the parsed gene regions and a second mask where in accessible sites have been set to "0". The character states are:

    0 => inaccessible
    1 => intergenic
    2 => intron
    3 => three_prime_utr
    4 => exon
    5 => five_prime_utr
    6 => cds

To generate the second file it needs a per-base accessibility mask (see the previous script above) that specifys whether the site is accessible or not, assuming the following character states:

    0 => inaccessible
    1 => accessible

### Usage example:

    gtf2gene_regions.comprehensive.pl \
        --length genome_sequence_lengths.csv \
        --gtf gene_annotation.gff3 \
        --coverage genome_mask_accessible.fasta \
        --output genome_mask_region

The script generates intergenic strings of "1"s for every sequence and then populate them with gene regions according to the annotations.
